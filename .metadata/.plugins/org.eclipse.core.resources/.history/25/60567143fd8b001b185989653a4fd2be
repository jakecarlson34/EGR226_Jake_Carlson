/**************************************************************************************
 * Author: Jake Carlson
 * Course: EGR 226 - 902
 * Date: 03/17/2021
 * Project: lab08part2
 * File: part2main.c
 * Description: This program controls the speed of a DC motor using Timer A.
 *
 *
 *
 **************************************************************************************/


#include "msp.h"
#include<stdlib.h>
#include<stdio.h>

uint8_t debounce();


void main(void)
{
    WDT_A->CTL = WDT_A_CTL_PW | WDT_A_CTL_HOLD;     // stop watchdog timer


    int i;
    float dutyCyc = .33;

    P5->SEL0 &= ~BIT0;
    P5->SEL1 &= ~BIT0;//button 1
    P5->DIR &= ~BIT0;
    P5->REN |= BIT0;
    P5->OUT |= BIT0;

    P5->SEL0 &= ~BIT1;
    P5->SEL1 &= ~BIT1;//button 2
    P5->DIR &= ~BIT1;
    P5->REN |= BIT1;
    P5->OUT |= BIT1;

    P5->SEL0 &= ~BIT2;
    P5->SEL1 &= ~BIT2;//button 3
    P5->DIR &= ~BIT2;
    P5->REN |= BIT2;
    P5->OUT |= BIT2;

    P2->SEL1 &=~BIT4;//initializing pin 2.4 for timer A use
    P2->SEL0 |= BIT4;
    P2->DIR |= BIT4;


    TIMER_A0->CCR[0] = 30000;
    TIMER_A0->CCTL[1] = TIMER_A_CCTLN_OUTMOD_7;
    TIMER_A0->CTL = 0x0214;



    while(1){

        TIMER_A0->CCR[1] = dutyCyc * 30000 ;
        i = debounce();

        if(i==1){
           if(dutyCyc < 1.0){
                dutyCyc += .1;
            }
        }
        if(i==2){
          if(dutyCyc > 0.0){
                dutyCyc -= .1;
            }
        }
        if(i==3){
            dutyCyc =0.0;
        }


    }
}

uint8_t debounce (){
    static uint16_t button1 = 0;
    static uint16_t button2 = 0;
    static uint16_t button3 = 0;

    button1 = (button1<<1)|((P5IN & BIT0)/BIT0)|0xf800;
    button2 = (button2<<1)|((P5IN & BIT1)/BIT0)|0xf800;
    button3 = (button3<<1)|((P5IN & BIT2)/BIT0)|0xf800;



    if(button1 == 0xfc00){
        return 1;
    }
    else if(button2 == 0xfc00){
            return 2;
        }
    else if(button3 == 0xfc00){
            return 3;
        }
    return 0;

}
